---
# systemd mounts require that the unit file name match the target mount location
# so we need to turn the something like:
# /docker/unifi-video
# into:
# docker-unifi-video.mount
# hence this pattern: {{ (item.local_path | regex_replace('/','-'))[1:] }}
- name: create mount point directories
  file:
    state: directory
    owner: root
    group: root
    path: "{{ item.local_path }}"
  loop: "{{ list_of_mounts }}"

- name: install systemd mounts
  template:
    src: templates/nfs_mount_template.mount
    dest: "/etc/systemd/system/{{ (item.local_path | regex_replace('/','-'))[1:] }}.mount"
    owner: root
    group: root
    mode: '0644'
  loop: "{{ list_of_mounts }}"

- name: reload systemd units
  systemd:
    daemon_reexec: yes

- name: enable mount
  systemd:
    name: "{{ (item.local_path | regex_replace('/','-'))[1:] }}.mount"
    enabled: yes
    state: started
  loop: "{{ list_of_mounts }}"
